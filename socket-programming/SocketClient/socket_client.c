// Declaring the libraries
#include <stdio.h>
#include <winsock2.h>
#include <ws2tcpip.h>
#pragma comment(lib, "ws2_32.lib")

// Main function
int main(void) {
    SOCKET client_socket;    // Create a SOCKET structure
    WSADATA wsastructure;    // Create a WSADATA structure required for winsock initialization
    int result;
    struct sockaddr_in client_addr;    // Create a strtucture required by the `connect()` function
    char sendData[500] = "Hello from the client!\n";
    char recvData[500];

    // Using the initialization function
    result = WSAStartup(MAKEWORD(2, 2), &wsastructure);    // Initialize winsock
    if(result != 0) {
        printf("[!] WinSock initialization failed!\n");    // print out the error and exit out of the program
        return 1;
    }

    // Create socket
    client_socket = socket(AF_INET, SOCK_STREAM, 0);    // Creates a TCP Socket

    // Structure Components
    client_addr.sin_family = AF_INET;
    client_addr.sin_port = htons(9001);
    client_addr.sin_addr.s_addr = inet_addr("10.0.2.15");

    connect(client_socket, (SOCKADDR *) &client_addr, sizeof(client_addr));    // Connect to the target server

    // Connection established. Receive and send data
    recv(client_socket, recvData, sizeof(recvData), 0);    // Recv data from server
    printf("Data from the server: %s\n", recvData);
    send(client_socket, sendData, sizeof(sendData), 0);    // Send data to server

    closesocket(client_socket);    // Close the socket connection and exit
    WSACleanup();    // Clean WSA

    return 0;
}