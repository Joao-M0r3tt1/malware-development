// Declaring the libraries
#include <stdio.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <netinet/in.h>

// Main function
int main(void) {
    int server_socket;    // Used to create and store the socket
    int client_socket;    // Used for accepting connection
    struct sockaddr_in  server_addr;    // Structure required by the `bind()`
    char buffer[500] = "Hello from the server!\n";    // Stores the server message, which will be sent to the client - 500 Bytes
    char recv_buffer[500];    // Stores the received data

    // Create socket
    server_socket = socket(AF_INET, SOCK_STREAM, 0);    // Creates a TCP Socket

    // Structure Components
    server_addr.sin_family = AF_INET;    // Declaring the type
    server_addr.sin_port = htons(9001);    // Declaring the port number to listen on
    server_addr.sin_addr.s_addr = inet_addr("10.0.2.15");   // Declaring the host.  

    bind(server_socket, (struct server_addr *) &server_addr, sizeof(server_addr));    // Bind the server
    listen(server_socket, 5);    // Listen to connections

    client_socket = accept(server_socket, NULL, NULL);    // Accept incoming connections
    printf("Client connected!\n");

    // Connection established. Send and receive data
    send(client_socket, buffer, sizeof(buffer), 0);    // Sending data to the client
    recv(client_socket, recv_buffer, sizeof(recv_buffer), 0);    // Recv data from the client
    printf("Client has sent: %s", recv_buffer);    // Print out the data sent by client
    close(server_socket);    // Close the connection

    return 0;
}